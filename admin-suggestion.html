<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Suggestions – HAFEDPOLY</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;}
body{margin:0;background:#f0f2f5;color:#333;}
header{display:flex;justify-content:space-between;align-items:center;padding:16px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.1);}
header h1{margin:0;color:#007bff;}
 .hamburger{width:28px;height:20px;display:flex;flex-direction:column;justify-content:space-between;cursor:pointer;}
    .hamburger span{display:block;height:3px;background:#007bff;border-radius:2px;transition:.3s;}
    .hamburger.active span:nth-child(1){transform:translateY(8.5px) rotate(45deg);}
    .hamburger.active span:nth-child(2){opacity:0;}
    .hamburger.active span:nth-child(3){transform:translateY(-8.5px) rotate(-45deg);}
nav{position:fixed;top:0;right:-250px;width:220px;height:100%;background:#fff;box-shadow:-2px 0 10px rgba(0,0,0,.15);padding:20px;transition:.3s;}
nav.active{right:0;}
nav a{display:block;margin:14px 0;color:#007bff;text-decoration:none;font-weight:600;}
.container{padding:20px;max-width:1200px;margin:20px auto;}
input{padding:8px 12px;border:1px solid #ccc;border-radius:6px;width:300px;margin-bottom:12px;}
input:focus,textarea:focus{
  border-color:#007bff;
  box-shadow:0 0 0 4px rgba(0,123,255,.12);
  outline:none;
}
table{width:100%;border-collapse:collapse;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,.1);}
th,td{padding:12px;text-align:left;border-bottom:1px solid #ddd;}
th{background:#007bff;color:#fff;}
td.actions button{margin-right:6px;padding:6px 12px;border:none;border-radius:6px;color:#fff;cursor:pointer;font-weight:600;}
.btn-verify{background:#6c757d;}
.btn-resolve{background:#28a745;}
.btn-delete{background:#dc3545;}
.btn-verify:hover{background:#5a6268;}
.btn-resolve:hover{background:#218838;}
.btn-delete:hover{background:#c82333;}
</style>
</head>
<body>

<header>
  <h1>Admin Suggestions</h1>
  <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
</header>

<nav id="nav">
  <a href="admin-dashboard.html">Dashboard</a>
  <a href="admin-complaint.html">Complaints</a>
  <a href="admin-suggestion.html">Suggestions</a>
  <a href="admin-announcement.html">Announcements</a>
  <a href="admin-verify.html">Verify IDs</a>
  <a href="admin-report.html">Admin report</a>
  <a href="#" id="logoutLink">Logout</a>
</nav>

<div class="container">
  <input type="text" id="searchInput" placeholder="Search by ID, Student ID, Reg No">
  <table>
    <thead>
      <tr>
        <th>Suggestion ID</th>
        <th>Category</th>
        <th>Title</th>
        <th>Description</th>
        <th>Student ID</th>
        <th>Reg No</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<script>
const $=id=>document.getElementById(id);
const hamburger=$("hamburger"), nav=$("nav");
hamburger.onclick=()=>{ hamburger.classList.toggle("active"); nav.classList.toggle("active"); };
$("logoutLink").addEventListener("click",()=>{ localStorage.removeItem("activeStudent"); location.href="login.html"; });

function loadSuggestions(filter=""){
  const suggestions = JSON.parse(localStorage.getItem("suggestions")||"[]");
  const tbody=$("tableBody"); tbody.innerHTML="";
  suggestions.forEach((s,i)=>{
    if(filter && !(s.suggestionId?.toLowerCase().includes(filter) || (s.studentId||"").toLowerCase().includes(filter) || (s.regno||"").toLowerCase().includes(filter))) return;

    // Ensure flags exist
    if(typeof s.verified==="undefined") s.verified=false;
    if(typeof s.resolved==="undefined") s.resolved=false;

    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${s.suggestionId||"N/A"}</td>
      <td>${s.category||"N/A"}</td>
      <td>${s.title||"N/A"}</td>
      <td>${s.desc||"N/A"}</td>
      <td>${s.anonymous?"null":(s.studentId||"N/A")}</td>
      <td>${s.anonymous?"null":(s.regno||"N/A")}</td>
      <td>
        ${s.verified ? "Verified" : "Pending"} /
        ${s.resolved ? "Resolved" : "Open"}
      </td>
      <td class="actions">
        <button class="btn-verify">${s.verified?"Verified":"Verify"}</button>
        <button class="btn-resolve">${s.resolved?"Resolved":"Resolve"}</button>
        <button class="btn-delete">Delete</button>
      </td>`;
    tbody.appendChild(tr);

    // ✅ Verify button
    tr.querySelector(".btn-verify").onclick=()=>{
      if(s.verified){ alert("Already verified."); return; }
      s.verified=true;
      s.verifier="Admin";
      localStorage.setItem("suggestions",JSON.stringify(suggestions));
      loadSuggestions($("searchInput").value.toLowerCase());
    };

    // ✅ Resolve button
    tr.querySelector(".btn-resolve").onclick=()=>{
      if(s.resolved) return;
      s.resolved=true;
      localStorage.setItem("suggestions",JSON.stringify(suggestions));
      loadSuggestions($("searchInput").value.toLowerCase());
    };

    // ✅ Delete button
    tr.querySelector(".btn-delete").onclick=()=>{
      if(confirm("Delete this suggestion?")){
        suggestions.splice(i,1);
        localStorage.setItem("suggestions",JSON.stringify(suggestions));
        loadSuggestions($("searchInput").value.toLowerCase());
      }
    };
  });
}

$("searchInput").addEventListener("input",()=>loadSuggestions($("searchInput").value.toLowerCase()));
loadSuggestions();
</script>

</body>
</html>
