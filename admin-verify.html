<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Verify â€“ HAFEDPOLY</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;}
body{margin:0;background:#f0f2f5;color:#333;}
header{display:flex;justify-content:space-between;align-items:center;padding:16px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.1);}
header h1{margin:0;color:#007bff;}
.hamburger{width:28px;height:20px;display:flex;flex-direction:column;justify-content:space-between;cursor:pointer;}
.hamburger span{height:3px;background:#007bff;border-radius:2px;display:block;}
.hamburger.active span:nth-child(1){transform:translateY(8.5px) rotate(45deg);}
.hamburger.active span:nth-child(2){opacity:0;}
.hamburger.active span:nth-child(3){transform:translateY(-8.5px) rotate(-45deg);}
nav{position:fixed;top:0;right:-250px;width:220px;height:100%;background:#fff;box-shadow:-2px 0 10px rgba(0,0,0,.15);padding:20px;transition:.3s;}
nav.active{right:0;}
nav a{display:block;margin:14px 0;color:#007bff;text-decoration:none;font-weight:600;}
.container{padding:20px;max-width:800px;margin:40px auto;}
input{padding:10px 12px;border:1px solid #ccc;border-radius:6px;width:70%;font-size:16px;}
input:focus{outline:none;border-color:#007bff;box-shadow:0 0 0 4px rgba(0,123,255,.12);}
button{padding:10px 14px;margin-left:10px;border:none;border-radius:6px;background:#007bff;color:#fff;font-weight:600;cursor:pointer;}
button:hover{background:#005ecb;}
.card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1);margin-top:20px;}
.card h3{margin-top:0;color:#007bff;}
.card p{margin:6px 0;}
.card button{margin-right:10px;}
.btn-verify{background:#28a745;}
.btn-delete{background:#dc3545;}
.btn-verify:hover{background:#218838;}
.btn-delete:hover{background:#c82333;}
</style>
</head>
<body>

<header>
  <h1>Admin Verify</h1>
  <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
</header>

<nav id="nav">
  <a href="admin-dashboard.html">Dashboard</a>
  <a href="admin-complaint.html">Complaints</a>
  <a href="admin-suggestion.html">Suggestions</a>
  <a href="#" id="logoutLink">Logout</a>
</nav>

<div class="container">
  <input type="text" id="searchInput" placeholder="Enter Student ID, Complaint ID, Suggestion ID, or Reg No">
  <button id="searchBtn">Search</button>
  <div id="result"></div>
</div>

<script>
const $ = id => document.getElementById(id);
const hamburger = $("hamburger"), nav = $("nav");

hamburger.onclick = () => { hamburger.classList.toggle("active"); nav.classList.toggle("active"); };
$("logoutLink").addEventListener("click", () => { localStorage.removeItem("activeAdmin"); location.href="login.html"; });

// Get student details from users
function getStudent(studentId){
    const users = JSON.parse(localStorage.getItem("users")||"[]");
    return users.find(u => u.uniqueId === studentId && u.role === "student") || {};
}

// Render the card for a found item
function showItem(item){
    const student = item.anonymous ? {} : getStudent(item.studentId);
    return `
        <div class="card">
            <h3>${item.type}: ${item.complaintId || item.suggestionId}</h3>
            <p><strong>Student ID:</strong> ${item.anonymous ? "Anonymous" : (student.uniqueId || "N/A")}</p>
            <p><strong>Reg No:</strong> ${item.anonymous ? "null" : (student.regno || "N/A")}</p>
            <p><strong>Name:</strong> ${item.anonymous ? "Anonymous" : (student.name || "N/A")}</p>
            <p><strong>Level:</strong> ${item.anonymous ? "N/A" : (student.level || "N/A")}</p>
            <p><strong>Category:</strong> ${item.category || "N/A"}</p>
            <p><strong>Title:</strong> ${item.title || "N/A"}</p>
            <p><strong>Description:</strong> ${item.desc || "N/A"}</p>
            <p><strong>Status:</strong> ${item.status || "Pending"}</p>
            <p><strong>Verifier:</strong> ${item.verifier || "N/A"}</p>
            <button class="btn-verify">${item.status==="Verified"?"Verified":"Verify"}</button>
            <button class="btn-delete">Delete</button>
        </div>
    `;
}

// Search logic
function searchItem(){
    const filter = $("searchInput").value.trim().toLowerCase();
    if(!filter) return alert("Please enter an ID or Reg No.");

    const complaints = JSON.parse(localStorage.getItem("complaints")||"[]");
    const suggestions = JSON.parse(localStorage.getItem("suggestions")||"[]");

    const allItems = complaints.map(c => ({...c, type:"Complaint"}))
                              .concat(suggestions.map(s => ({...s, type:"Suggestion"})));

    const found = allItems.find(item => {
        const idVal = (item.complaintId || item.suggestionId || "").toLowerCase();
        const studentId = (item.studentId || "").toLowerCase();
        const student = getStudent(item.studentId);
        const regNo = (student.regno || "").toLowerCase();
        return [idVal, studentId, regNo].includes(filter);
    });

    const container = $("result");
    container.innerHTML = "";

    if(!found) return container.innerHTML="<p>No record found.</p>";

    container.innerHTML = showItem(found);

    const card = container.firstElementChild;

    // Verify button
    card.querySelector(".btn-verify").onclick = () => {
        if(found.status==="Verified") return;
        found.status = "Verified";
        found.verifier = "Admin";
        if(found.type==="Complaint") localStorage.setItem("complaints", JSON.stringify(complaints));
        else localStorage.setItem("suggestions", JSON.stringify(suggestions));
        searchItem();
    };

    // Delete button
    card.querySelector(".btn-delete").onclick = () => {
        if(confirm("Delete this entry?")){
            if(found.type==="Complaint"){
                complaints.splice(complaints.indexOf(found),1);
                localStorage.setItem("complaints", JSON.stringify(complaints));
            } else {
                suggestions.splice(suggestions.indexOf(found),1);
                localStorage.setItem("suggestions", JSON.stringify(suggestions));
            }
            container.innerHTML="<p>Entry deleted.</p>";
        }
    };
}

// Event listeners
$("searchBtn").addEventListener("click", searchItem);
$("searchInput").addEventListener("keypress", e => { if(e.key==="Enter"){ e.preventDefault(); searchItem(); } });

</script>

</body>
</html>